kong:
#  image: emarsys/kong-dev-docker:latest
  build: .
  dockerfile: Dockerfile
  depends_on:
    - kong-database
  environment:
    - KONG_DATABASE=postgres
    - KONG_PG_HOST=kong-database
    - KONG_PG_DATABASE=kong
    - KONG_PG_PASSWORD=kong
    - KONG_ADMIN_LISTEN=0.0.0.0:8001
    - KONG_ADMIN_LISTEN_SSL=0.0.0.0:8444
    - KONG_PLUGIN_PATH=/kong-plugins
    - KONG_CUSTOM_PLUGINS=wsse
    - KONG_NGINX_DAEMON=off
    - LUA_PATH=/kong-plugins/?.lua;/kong-plugins/?/init.lua;;
    - PGPASSWORD=kong
  encrypted_env_file: env.encrypted
  ports:
    - 8000
    - 8001
    - 8443
    - 8444
  volumes:
    - .:/kong-plugins
    - ./spec/kong_tests.conf:/kong/spec/kong_tests.conf

kong-database:
  image: postgres:9.5
  environment:
    - POSTGRES_USER=kong
    - POSTGRES_DB=kong
    - POSTGRES_PASSWORD=kong